<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="https://i.ibb.co/4d1y4gV/image-2024-02-27-172652050-removebg-preview.png">
    <link href="./output.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet">
    <title>Profile</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            color: #fff;
        }
        body {
    animation: fadeInAnimation ease 3s;
    animation-iteration-count: 1;
    animation-fill-mode: forwards;
}

@keyframes fadeInAnimation {
    0% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}


        .header-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        .header-bg img {
            opacity: 0.1;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
        }
    </style>
</head>
<body class="bg-neutral-950">
    <main>
        <div class="flex justify-center items-center h-screen">
            <div class="header-bg">
                <img src="https://i.ibb.co/S7r4ZK8/header-bacwkground.png" alt="BG GLOW">
            </div>          
                <div class="profile w-[25rem] mx-4">
                <div class="top flex items-center">
                    <div class="img" id="profilePic">
                        <img class="w-[64px] h-[64px] object-cover rounded-full" src="">
                    </div>
                    <div class="user ml-3">
                        <div class="username text-white text-xl font-semibold leading-tight">
                            <a id="usernameLink" href="#"></a>
                        </div>
                        <div class="tag text-white text-opacity-25">
                            <a id="tagLink" href="#"></a>
                        </div>
                    </div>
                </div>

                <!--Activity-->
                <div class="spotify status bg-neutral-900 bg-opacity-35 rounded-xl p-3 mt-5 w-full">
                    <div class="info flex items-center">
                        <div class="cover order-1">
                            <img id="imgActivity" src="https://i.ibb.co/g7P1k79/image-2024-02-27-172652050-removebg-preview.png" width="128" height="128" draggable="false" alt="Activity Image" class="rounded-xl">
                        </div>                        
                        <div class="title text-white ml-4 overflow-x-hidden order-2 truncate" style="width: calc(100% - 64px);">
                            <a id="name"  rel="noreferrer"  class=" font-semibold text-lg leading-tight ">
                                
                            </a>
                            <a id="details" href="#" target="_blank" rel="noreferrer" title="Open on Spotify" class="cursor-pointer font-semibold text-lg leading-tight hover:underline">
                            </a>
                            <h2 class="leading-tight opacity-90 line-clamp-2 text-white text-opacity-80" id="state"></h2>
                            <h2 class="leading-tight opacity-90 line-clamp-2 text-white text-opacity-80" id="artist"></h2>
                            <h2 class="leading-tight opacity-90 line-clamp-2 text-white text-opacity-80" id="album"></h2>
                            <h2 class="leading-tight opacity-90 line-clamp-2 text-white text-opacity-80" id="large_text"></h2>
                        </div>
                    </div>
                    <div id="timestamp" style="display:none;">
                        <div class="rounded-lg bg-gray-200/20 h-2 mt-4">
                            <div id="trackbar" class="rounded-lg bg-white/75 h-2 transition-all" style="width: 0%;"></div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span id="currentTime">-</span>
                            <span id="totalTime">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>


    
    <script>
  // Set default image source
const defaultImageUrl = 'https://i.ibb.co/g7P1k79/image-2024-02-27-172652050-removebg-preview.png';

// Function to fetch data and update UI
function fetchDataAndUpdateUI(discordId) {
    fetch(`https://api.lanyard.rest/v1/users/${discordId}`)
        .then(response => response.json())
        .then(data => {
            if (!data.success) {
                window.location.href = "https://sye.lol/";
                return;
            }
            // Redirect to the user's profile page with the custom URL structure
            window.location.href = `https://sye.lol/${discordId}`;

            // Rest of your code for updating the UI goes here...
            // Extract Discord username, tag, and status
            const username = data.data.discord_user.display_name;
            const tag = data.data.discord_user.username;

            // Update Discord information
            document.getElementById("usernameLink").innerText = username;
            document.getElementById("tagLink").innerText = tag;
            // Extract avatar hash
            const avatarHash = data.data.discord_user.avatar;
            // Set profile avatar using the provided hash
            const avatarUrl = `https://cdn.discordapp.com/avatars/${data.data.discord_user.id}/${avatarHash}.png`;
            document.getElementById("profilePic").innerHTML = `<img class="w-[64px] h-[64px] object-cover rounded-full" src="${avatarUrl}" alt="Profile Picture">`;
            // Extract Spotify data if available
            const spotifyData = data.data.spotify;
            if (spotifyData) {
                // Show the timestamp
                document.getElementById("timestamp").style.display = "block";

                // Display Spotify data
                document.getElementById("state").innerText = spotifyData.artist;
                document.getElementById("details").innerText = spotifyData.song;
                document.getElementById("details").style.display = "flex";
                document.getElementById("album").style.display = "flex";
                document.getElementById("large_text").style.display = "none";
                document.getElementById("album").innerText = spotifyData.album;
                document.getElementById("name").innerText = ""; // Clear the name element

                // Display album cover image
                document.getElementById("imgActivity").src = spotifyData.album_art_url;

                // Calculate and display timestamps
                const currentTime = new Date().getTime();
                const startTime = spotifyData.timestamps.start;
                const endTime = spotifyData.timestamps.end;
                const totalTime = endTime - startTime;
                const elapsedTime = currentTime - startTime;

                document.getElementById("currentTime").innerText = formatTime(elapsedTime);
                document.getElementById("totalTime").innerText = formatTime(totalTime);

                // Update trackbar width
                const trackbarWidth = (elapsedTime / totalTime) * 100;
                document.getElementById("trackbar").style.width = `${trackbarWidth}%`;
            } else {
                // If not listening to Spotify, display other activity
                const otherActivity = data.data.activities.find(activity => activity.type !== 2 && activity.name !== "Custom Status");
                if (otherActivity) {
                    // Hide the timestamp
                    document.getElementById("timestamp").style.display = "none";
                    document.getElementById("details").style.display = "none";
                    if (document.getElementById("large_text").innerText.trim() === "Idling") {
                        document.getElementById("large_text").style.display = "none";
                    } else {
                        document.getElementById("large_text").style.display = "flex";
                    }
                    document.getElementById("album").style.display = "none";
                    document.getElementById("state").innerText = otherActivity.details;
                    document.getElementById("name").innerText = otherActivity.name;

                    // Check if 'large_image' exists and is not undefined before setting its value
                    if (otherActivity.assets && otherActivity.assets.large_image !== undefined) {
                        const applicationId = otherActivity.application_id;
                        const largeImageId = otherActivity.assets.large_image;
                        const largeImageUrl = `https://cdn.discordapp.com/app-assets/${applicationId}/${largeImageId}.png`;
                        // Set the source of the image
                        document.getElementById("imgActivity").src = largeImageUrl;
                        // Add an error handler to replace the image with the default image if it fails to load
                        document.getElementById("imgActivity").onerror = function () {
                            document.getElementById("imgActivity").src = defaultImageUrl;
                        };
                    } else {
                        // Display the default image if no large image asset is provided
                        document.getElementById("imgActivity").src = defaultImageUrl;
                    }

                    // Check if 'large_text' exists and is not undefined before setting its value
                    if (otherActivity.assets && otherActivity.assets.large_text !== undefined) {
                        document.getElementById("large_text").innerText = otherActivity.assets.large_text;
                    }
                } else {
                    // If no activity is found or if all activities are "Custom Status", display "User is not doing anything"
                    document.getElementById("state").innerText = "User is not doing anything";
                    document.getElementById("details").style.display = ""; // Clear the details element
                    document.getElementById("large_text").innerText = "";
                    document.getElementById("details").style.display = "none";
                    document.getElementById("album").style.display = "none";
                    document.getElementById("name").innerText = ""; // Clear the name element
                    document.getElementById("imgActivity").src = defaultImageUrl;

                    // Hide the timestamp
                    document.getElementById("timestamp").style.display = "none";
                }
            }
        })
        .catch(error => console.error("Error fetching data:", error));
}

// Function to format time in mm:ss format
function formatTime(milliseconds) {
    const totalSeconds = Math.floor(milliseconds / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
}

    window.location.href = `https://sye.lol/${discordId}`;
        })
        .catch(error => console.error("Error fetching data:", error));
}

// Extract Discord ID from the URL pathname
const discordId = window.location.pathname.substring(1);

// Call the function initially
fetchDataAndUpdateUI(discordId);

// Set interval to fetch data and update UI every 2 seconds
let intervalId = setInterval(() => fetchDataAndUpdateUI(discordId), 1000);

    </script>
    
</body>
</html>
